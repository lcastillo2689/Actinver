BEGIN 

execute immediate 'CREATE SEQUENCE "SQ_OKR_CAT_ESTATUS_EVALUACION" start with 1';

execute immediate 'CREATE TABLE "OKR_CAT_ESTATUS_EVALUACION" (
    "ESTATUS_EVALUACION_ID" NUMBER(19) NOT NULL,
    "DESCRIPCION" NVARCHAR2(255) NOT NULL,
    "LAST_UPDATE" TIMESTAMP(7) DEFAULT (sysdate) NOT NULL,
    "ACTIVE_FLAG" NUMBER(1) DEFAULT 1 NOT NULL,
    CONSTRAINT "PK_ESTATUS_EVALUACION" PRIMARY KEY ("ESTATUS_EVALUACION_ID")
)';
execute immediate 'create or replace trigger "TR_OKR_CAT_ESTATUS_EVALUACION"
before insert on "OKR_CAT_ESTATUS_EVALUACION" for each row 
begin 
  if :new."ESTATUS_EVALUACION_ID" is NULL then 
    select "SQ_OKR_CAT_ESTATUS_EVALUACION".nextval into :new."ESTATUS_EVALUACION_ID" from dual;  
  end if; 
end;';
END;
/

BEGIN 

execute immediate 'CREATE SEQUENCE "SQ_OKR_EVALUACION" start with 1';

execute immediate 'CREATE TABLE "OKR_EVALUACION" (
    "EVALUACION_ID" NUMBER(19) NOT NULL,
    "EVALUACION_ESTATUS_ID" NUMBER(19) NOT NULL,
    "AUTOEVALUACION" NUMBER(1) DEFAULT 1 NOT NULL,
    "CALIFICACION_OBJETIVOS" DECIMAL(18,2),
    "CALIFICACION_RESULTADOS_CLAVE" DECIMAL(18,2),
    "TOTAL_CALIFICACION" DECIMAL(18,2),
    "START_DATE" TIMESTAMP(7),
    "LAST_UPDATE" TIMESTAMP(7) DEFAULT (sysdate) NOT NULL,
    "ACTIVE_FLAG" NUMBER(1) DEFAULT 1 NOT NULL,
    CONSTRAINT "PK_OKR_EVALUACION" PRIMARY KEY ("EVALUACION_ID"),
    CONSTRAINT "FK_ESTATUS_EVALUACION" FOREIGN KEY ("EVALUACION_ESTATUS_ID") REFERENCES "OKR_CAT_ESTATUS_EVALUACION" ("ESTATUS_EVALUACION_ID") ON DELETE CASCADE
)';
execute immediate 'create or replace trigger "TR_OKR_EVALUACION"
before insert on "OKR_EVALUACION" for each row 
begin 
  if :new."EVALUACION_ID" is NULL then 
    select "SQ_OKR_EVALUACION".nextval into :new."EVALUACION_ID" from dual;  
  end if; 
end;';
END;
/

BEGIN 

execute immediate 'CREATE SEQUENCE "SQ_OKR_EVALUACION_E_1206273447" start with 1';

execute immediate 'CREATE TABLE "OKR_EVALUACION_EMPLEADO_XREF" (
    "EVALUACION_EMPLEADO_ID" NUMBER(19) NOT NULL,
    "EVALUACION_ID" NUMBER(19) NOT NULL,
    "EMPLEADO_ID" NUMBER(19) NOT NULL,
    "LAST_UPDATE" TIMESTAMP(7) DEFAULT (sysdate) NOT NULL,
    "ACTIVE_FLAG" NUMBER(1) DEFAULT 1 NOT NULL,
    CONSTRAINT "PK_EVALUACION_EMPLEADO" PRIMARY KEY ("EVALUACION_EMPLEADO_ID"),
    CONSTRAINT "FK_EMPLEADO_EVAL_XREF" FOREIGN KEY ("EMPLEADO_ID") REFERENCES "OKR_EMPLEADOS" ("EMPLEADO_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_EVALUACION_EMPLEADO_XREF" FOREIGN KEY ("EVALUACION_ID") REFERENCES "OKR_EVALUACION" ("EVALUACION_ID") ON DELETE CASCADE
)';
execute immediate 'create or replace trigger "TR_OKR_EVALUACION_EMP_12383937"
before insert on "OKR_EVALUACION_EMPLEADO_XREF" for each row 
begin 
  if :new."EVALUACION_EMPLEADO_ID" is NULL then 
    select "SQ_OKR_EVALUACION_E_1206273447".nextval into :new."EVALUACION_EMPLEADO_ID" from dual;  
  end if; 
end;';
END;
/

CREATE INDEX "IX_EVALUACION_ESTATUS_ID" ON "OKR_EVALUACION" ("EVALUACION_ESTATUS_ID")
/

CREATE INDEX "IX_EVALUACION_EMPLEADO_ID" ON "OKR_EVALUACION_EMPLEADO_XREF" ("EMPLEADO_ID")
/

CREATE UNIQUE INDEX "IX_EMPLEADO_EVALUACION_ID" ON "OKR_EVALUACION_EMPLEADO_XREF" ("EVALUACION_ID")
/

INSERT INTO OKR_CAT_ESTATUS_EVALUACION(ESTATUS_EVALUACION_ID,DESCRIPCION) VALUES(1, 'Autoevaluación')
/

INSERT INTO OKR_CAT_ESTATUS_EVALUACION(ESTATUS_EVALUACION_ID,DESCRIPCION) VALUES(2, 'Revisión')
/

INSERT INTO OKR_CAT_ESTATUS_EVALUACION(ESTATUS_EVALUACION_ID,DESCRIPCION) VALUES(3, 'Finalizada')
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220310002942_OKR_Evaluacion_Empleado', N'5.0.12')
/

BEGIN 

execute immediate 'CREATE SEQUENCE "SQ_OKR_OBJETIVOS_CALIFICACION" start with 1';

execute immediate 'CREATE TABLE "OKR_OBJETIVOS_CALIFICACION" (
    "OBJETIVO_CALIFICACION_ID" NUMBER(19) NOT NULL,
    "OBJETIVO_ID" NUMBER(18) NOT NULL,
    "EVALUACION_ID" NUMBER(18) NOT NULL,
    "CALIFICACION" NUMBER(1),
    "RESULTADO" NVARCHAR2(2000),
    "ACTIVE_FLAG" NUMBER(1) DEFAULT 1 NOT NULL,
    "LAST_UPDATE" TIMESTAMP(7) DEFAULT (sysdate) NOT NULL,
    CONSTRAINT "PK_OBJETIVOS_CALIFICACION" PRIMARY KEY ("OBJETIVO_CALIFICACION_ID"),
    CONSTRAINT "FK_EVALUACION_OBJETIVOS" FOREIGN KEY ("EVALUACION_ID") REFERENCES "OKR_EVALUACION" ("EVALUACION_ID") ON DELETE CASCADE,
    CONSTRAINT "FK_OBJETIVO_CALIFICACION" FOREIGN KEY ("OBJETIVO_ID") REFERENCES "OKR_OBJETIVOS" ("OBJETIVO_ID") ON DELETE CASCADE
)';
execute immediate 'create or replace trigger "TR_OKR_OBJETIVOS_CALIFICACION"
before insert on "OKR_OBJETIVOS_CALIFICACION" for each row 
begin 
  if :new."OBJETIVO_CALIFICACION_ID" is NULL then 
    select "SQ_OKR_OBJETIVOS_CALIFICACION".nextval into :new."OBJETIVO_CALIFICACION_ID" from dual;  
  end if; 
end;';
END;
/

CREATE INDEX "IX_OBJETIVOS_EVALUACION" ON "OKR_OBJETIVOS_CALIFICACION" ("EVALUACION_ID")
/

CREATE UNIQUE INDEX "IX_CALIFICACION_OBJETIVO" ON "OKR_OBJETIVOS_CALIFICACION" ("OBJETIVO_ID")
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220310162526_Add_OKR_OBJETIVO_CALIFICACION', N'5.0.12')
/

ALTER TABLE "OKR_EVALUACION" RENAME COLUMN "START_DATE" TO "FECHA_INICIO"
/

ALTER TABLE "OKR_EVALUACION" ADD "PERIODO_EVALUACION_ID" NUMBER(19) DEFAULT 0 NOT NULL
/

BEGIN 

execute immediate 'CREATE SEQUENCE "SQ_OKR_CAT_PERIODO_EVALUACION" start with 1';

execute immediate 'CREATE TABLE "OKR_CAT_PERIODO_EVALUACION" (
    "PERIODO_EVALUACION_ID" NUMBER(19) NOT NULL,
    "DESCRIPCION" NVARCHAR2(255) NOT NULL,
    "ACTIVE_FLAG" NUMBER(1) DEFAULT 1 NOT NULL,
    "LAST_UPDATE" TIMESTAMP(7) DEFAULT (sysdate) NOT NULL,
    CONSTRAINT "PK_PERIODO_EVALUACION" PRIMARY KEY ("PERIODO_EVALUACION_ID")
)';
execute immediate 'create or replace trigger "TR_OKR_CAT_PERIODO_EVALUACION"
before insert on "OKR_CAT_PERIODO_EVALUACION" for each row 
begin 
  if :new."PERIODO_EVALUACION_ID" is NULL then 
    select "SQ_OKR_CAT_PERIODO_EVALUACION".nextval into :new."PERIODO_EVALUACION_ID" from dual;  
  end if; 
end;';
END;
/

CREATE INDEX "IX_EVALUACION_PERIODO" ON "OKR_EVALUACION" ("PERIODO_EVALUACION_ID")
/

ALTER TABLE "OKR_EVALUACION" ADD CONSTRAINT "FK_PERIODO_EVALUACION" FOREIGN KEY ("PERIODO_EVALUACION_ID") REFERENCES "OKR_CAT_PERIODO_EVALUACION" ("PERIODO_EVALUACION_ID") ON DELETE CASCADE
/

INSERT INTO OKR_CAT_PERIODO_EVALUACION(PERIODO_EVALUACION_ID,DESCRIPCION) VALUES(1, 'Primer Trimestre')
/

INSERT INTO OKR_CAT_PERIODO_EVALUACION(PERIODO_EVALUACION_ID,DESCRIPCION) VALUES(2, 'Segundo Trimestre')
/

INSERT INTO OKR_CAT_PERIODO_EVALUACION(PERIODO_EVALUACION_ID,DESCRIPCION) VALUES(3, 'Tercer Trimestre')
/

INSERT INTO OKR_CAT_PERIODO_EVALUACION(PERIODO_EVALUACION_ID,DESCRIPCION) VALUES(4, 'Cuarto Trimestre')
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220310165535_Add_OKR_PERIODO_EVALUACION', N'5.0.12')
/

INSERT INTO OKR_CAT_ESTATUS(ESTATUS_ID,DESCRIPCION) VALUES(5, 'En Evaluación')
/

INSERT INTO OKR_CAT_ESTATUS(ESTATUS_ID,DESCRIPCION) VALUES(6, 'Calificado')
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220311160539_AddNewObjetivoEstatus', N'5.0.12')
/

DROP INDEX "IX_CALIFICACION_OBJETIVO"
/

CREATE INDEX "IX_OKR_OBJETIVOS_CALIFICACION_OBJETIVO_ID" ON "OKR_OBJETIVOS_CALIFICACION" ("OBJETIVO_ID")
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220313215624_FixRelationsOKR_OBJETIVO_CALIFICACIONES', N'5.0.12')
/

ALTER TABLE "OKR_EVALUACION" MODIFY "AUTOEVALUACION" DEFAULT NULL
/

declare
   l_nullable user_tab_columns.nullable % type;
begin 
   select nullable into l_nullable 
   from user_tab_columns 
  where table_name = 'OKR_EVALUACION' 
  and column_name = 'AUTOEVALUACION' 
;
   if l_nullable = 'N' then 
        EXECUTE IMMEDIATE 'ALTER TABLE "OKR_EVALUACION" MODIFY "AUTOEVALUACION" NUMBER(1) ';
 else 
        EXECUTE IMMEDIATE 'ALTER TABLE "OKR_EVALUACION" MODIFY "AUTOEVALUACION" NUMBER(1) NOT NULL';
 end if;
end;
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220313224331_FixAutoevaluacion_OKR_EVALUACION', N'5.0.12')
/

ALTER TABLE "OKR_OBJETIVOS_MEDICIONES" ADD "BENCHMARK" NVARCHAR2(500)
/

ALTER TABLE "OKR_OBJETIVOS_MEDICIONES" ADD "FORMULA" NVARCHAR2(500)
/

ALTER TABLE "OKR_OBJETIVOS" ADD "PONDERACION" DECIMAL(18,2)
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220314213245_AddPesoObjetivosMediciones', N'5.0.12')
/

BEGIN 

execute immediate 'CREATE SEQUENCE "SQ_OKR_RETROALIMENTACION" start with 1';

execute immediate 'CREATE TABLE "OKR_RETROALIMENTACION" (
    "RETROALIMENTACION_ID" NUMBER(19) NOT NULL,
    "EMPLEADO_ID" NUMBER(19) NOT NULL,
    "EVALUACION_ACORDADA" NUMBER(1) NOT NULL,
    "COMENTARIOS" NVARCHAR2(1024),
    "NECESIDADES" NVARCHAR2(1024),
    "COMPROMISOS" NVARCHAR2(1024),
    "MEJORA_AUTOSUGERIDA" NVARCHAR2(1024),
    "CERRADA" NUMBER(1) DEFAULT 0 NOT NULL,
    "LAST_UPDATE" TIMESTAMP(7) DEFAULT (sysdate) NOT NULL,
    "ACTIVE_FLAG" NUMBER(1) DEFAULT 1 NOT NULL,
    CONSTRAINT "PK_OKR_RETROALIMENTACION" PRIMARY KEY ("RETROALIMENTACION_ID"),
    CONSTRAINT "FK_EMPLEADO_RETROALIMENTACION" FOREIGN KEY ("EMPLEADO_ID") REFERENCES "OKR_EMPLEADOS" ("EMPLEADO_ID") ON DELETE CASCADE
)';
execute immediate 'create or replace trigger "TR_OKR_RETROALIMENTACION"
before insert on "OKR_RETROALIMENTACION" for each row 
begin 
  if :new."RETROALIMENTACION_ID" is NULL then 
    select "SQ_OKR_RETROALIMENTACION".nextval into :new."RETROALIMENTACION_ID" from dual;  
  end if; 
end;';
END;
/

CREATE INDEX "IX_OKR_RETROALIMENTACION_EMPLEADO_ID" ON "OKR_RETROALIMENTACION" ("EMPLEADO_ID")
/

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES (N'20220317015507_Add_OKR_RETROALIEMNTACION', N'5.0.12')
/

