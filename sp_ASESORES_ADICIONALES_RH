create or replace PROCEDURE sp_ASESORES_ADICIONALES_RH
( 
  SNAPSHOT_DATE_PARAM DATE,
  CUR_PARAM OUT sys_REFCURSOR
)
AS
BEGIN
  OPEN CUR_PARAM FOR 
  SELECT 
    DISTINCT
    DD.ID_DIRECCION_DIV AS DIRECCION_DIVISIONAL_ID,
    DD.NUMERO_DIRECCION AS NUMERO_DIRECCION_DIVISIONAL,
    DD.DESC_DIRECCION_DIV AS DIRECCION_DIVISIONAL,
    DR.ID_DIRECCION_REGIONAL AS DIRECCION_REGIONAL_ID,
    DR.NUMERO_REGION AS NUMERO_DIRECCION_REGIONAL,
    DR.DESC_DIRECCION_REGIONAL AS DIRECCION_REGIONAL,
    CF.ID_CF AS CENTRO_FINANCIERO_ID,
    CF.NUMERO_CF AS NUMERO_CENTRO_FINANCIERO,
    CF.DESC_CF AS CENTRO_FINANCIERO,
    AAD.NOMINA AS NUMERO_ASESOR,
    AAD.NOMBRE_ASESOR_GENERICO AS ASESOR,
    R.ID_ASESOR AS REPORTA_ID,
    AAD.NOMINA_REFERENCIADO AS NUMERO_REPORTA,
    R.NOMBRE_ASESOR AS REPORTA,
    AAD.TIPO_DE_USUARIO AS TIPO_ASESOR
  FROM DC_ASESORES_ADICIONALES AAD
  INNER JOIN SL_CAT_CENTROS_FINANCIEROS CF ON AAD.ID_CENTRO_FINANCIERO = CF.NUMERO_CF AND CF.BAJA_LOGICA = 0
  INNER JOIN SL_CF_DR_XREF CFDR ON CF.ID_CF = CFDR.ID_CF AND CFDR.FECHA_ALTA <= SNAPSHOT_DATE_PARAM AND (CFDR.FECHA_BAJA IS NULL OR CFDR.FECHA_BAJA > SNAPSHOT_DATE_PARAM) AND CFDR.BAJA_LOGICA = 0
  INNER JOIN SL_CAT_DIRECCIONES_REGIONALES DR ON CFDR.ID_DIRECCION_REGIONAL = DR.ID_DIRECCION_REGIONAL AND DR.BAJA_LOGICA = 0
  INNER JOIN SL_DR_DD_XREF DRDD ON DR.ID_DIRECCION_REGIONAL = DRDD.ID_DIRECCION_REGIONAL AND DRDD.FECHA_ALTA <= SNAPSHOT_DATE_PARAM AND (DRDD.FECHA_BAJA IS NULL OR DRDD.FECHA_BAJA > SNAPSHOT_DATE_PARAM) AND DRDD.BAJA_LOGICA = 0
  INNER JOIN SL_CAT_DIRECCIONES_DIV DD ON DRDD.ID_DIRECCION_DIV = DD.ID_DIRECCION_DIV AND DD.BAJA_LOGICA = 0
  LEFT JOIN SL_ASESORES R ON AAD.NOMINA_REFERENCIADO = R.NUM_ASESOR AND R.BAJA_LOGICA = 0
  WHERE AAD.SNAPSHOT_DATE = SNAPSHOT_DATE_PARAM
  ORDER BY AAD.NOMBRE_ASESOR_GENERICO;
END;
